{% extends "base.html" %}

{% block title %}Neue Bestellung – Grocery Vergleich{% endblock %}

{% block content %}
<div class="card">
  <h1>Neue Bestellung erfassen</h1>
  <p class="subtitle">
    Lege einen Einkauf mit Datum, Supermarkt und mehreren Produkten an. 
    Die Preise werden aus den aktuellen Supermarkt-Preisen übernommen.
  </p>

  {% if error %}
    <p style="color:#b91c1c; font-size:14px; margin-bottom:12px;">
      {{ error }}
    </p>
  {% endif %}

  <form method="post">
    <div style="display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap;">
      <div>
        <label style="font-size:13px; color:#4b5563;">Datum</label><br>
        <input type="date" name="order_date"
               style="padding:6px 8px; border-radius:8px; border:1px solid #e5e7eb;">
      </div>
      <div>
        <label style="font-size:13px; color:#4b5563;">Supermarkt *</label><br>
        <select name="supermarket_id"
                style="padding:6px 8px; border-radius:8px; border:1px solid #e5e7eb; min-width:160px;">
          <option value="">Bitte wählen …</option>
          {% for s in supermarkets %}
          <option value="{{ s['id'] }}">{{ s["name"] }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <h3>Positionen</h3>
    <p class="subtitle">
      Wähle bis zu 3 Produkte und Mengen. Nur Positionen mit vorhandenem Preis im gewählten Supermarkt werden berücksichtigt.
    </p>

    <table>
      <tr>
        <th>Produkt</th>
        <th>Menge</th>
      </tr>
      {% for i in range(1, 4) %}
      <tr>
        <td>
          <select name="product_{{ i }}"
                  style="width:100%; padding:4px 6px; border-radius:6px; border:1px solid #e5e7eb;">
            <option value="">– kein Produkt –</option>
            {% for p in products %}
            <option value="{{ p['id'] }}">
              {{ p["name"] }}{% if p["brand"] %} ({{ p["brand"] }}){% endif %}
            </option>
            {% endfor %}
          </select>
        </td>
        <td>
          <input type="number" name="qty_{{ i }}" min="1"
                 style="width:80px; padding:4px 6px; border-radius:6px; border:1px solid #e5e7eb;">
        </td>
      </tr>
      {% endfor %}
    </table>

    <div style="margin-top:16px;">
      <button type="submit" class="btn-primary">Bestellung speichern</button>
    </div>
  </form>
</div>
{% endblock %}
