{% extends "base.html" %}

{% block title %}Produktsuche – Grocery Vergleich{% endblock %}

{% block content %}
<div class="card">
  <h1>Produktsuche</h1>
  <p class="subtitle">
    Suche nach einem Lebensmittel (z.&nbsp;B. <strong>Vollmilch</strong>, <strong>Spaghetti</strong>) 
    und vergleiche die Preise in deinen Märkten.
  </p>

  <form method="post">
    <div class="search-bar">
      <input
        type="text"
        name="q"
        value="{{ query }}"
        placeholder="Produktname oder Kategorie eingeben …">
      <button class="btn-primary" type="submit">
        Suchen
      </button>
    </div>
  </form>

  {% if products %}
    <div class="results-meta">
      {{ products|length }} Preisangebote gefunden
      {% if query %}für „{{ query }}“{% endif %}
    </div>
    <table>
      <tr>
        <th>Produkt</th>
        <th>Marke</th>
        <th>Kategorie</th>
        <th>Supermarkt</th>
        <th>Preis</th>
        <th>Aktionen</th>
      </tr>
      {% for row in products %}
      <tr>
        <td>{{ row["name"] }}</td>
        <td>{{ row["brand"] or "–" }}</td>
        <td>{{ row["category"] or "–" }}</td>
        <td>{{ row["supermarket_name"] }}</td>
        <td class="price">{{ "%.2f"|format(row["price"]) }} €</td>
        <td>
          <a href="{{ url_for('save_product', product_id=row['product_id']) }}">
            Auf Merkliste
          </a>
        </td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p class="empty-state">
      {% if query %}
        Keine Produkte für „{{ query }}“ gefunden.
      {% else %}
        Noch keine Ergebnisse – starte eine Suche, um Angebote zu sehen.
      {% endif %}
    </p>
  {% endif %}
</div>
{% endblock %}
